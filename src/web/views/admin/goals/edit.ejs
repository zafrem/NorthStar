<%- include('../../layouts/main', { body: `
<div class="page-header">
  <h1>${goal ? 'Edit Goal' : 'Create Goal'}</h1>
  <p class="page-subtitle">${goal ? 'Update goal information' : 'Create a new goal'}</p>
</div>

${success ? `<div class="alert alert-success">${success}</div>` : ''}
${error ? `<div class="alert alert-error">${error}</div>` : ''}

<div class="card">
  <div class="card-body">
    <form action="${goal ? '/admin/goals/' + goal.id : '/admin/goals'}" method="POST">
      <div class="form-group">
        <label for="title">Title *</label>
        <input type="text" id="title" name="title" value="${goal ? goal.title : ''}" required>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" rows="3">${goal ? (goal.description || '') : ''}</textarea>
      </div>

      ${goal ? '' : `
      <div class="form-row">
        <div class="form-group">
          <label for="orgId">Organization *</label>
          <select id="orgId" name="orgId" required>
            <option value="">Select organization...</option>
            ${organizations.map(org => `
              <option value="${org.id}">${org.name}</option>
            `).join('')}
          </select>
        </div>
        <div class="form-group">
          <label for="ownerId">Owner</label>
          <select id="ownerId" name="ownerId">
            <option value="">No owner</option>
            ${users.map(u => `
              <option value="${u.id}">${u.name}</option>
            `).join('')}
          </select>
        </div>
      </div>
      `}

      ${goal ? `
      <div class="form-row">
        <div class="form-group">
          <label>Organization</label>
          <p class="form-static">${organizations.find(o => o.id === '${goal.orgId}')?.name || 'Unknown'}</p>
        </div>
        <div class="form-group">
          <label>Owner</label>
          <p class="form-static">
            ${goal.ownerId ? (users.find(u => u.id === '${goal.ownerId}')?.name || 'Unknown') : 'No owner'}
          </p>
        </div>
      </div>
      ` : ''}

      <div class="form-row">
        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="not_started" ${goal && goal.status === 'not_started' ? 'selected' : ''}>Not Started</option>
            <option value="in_progress" ${goal && goal.status === 'in_progress' ? 'selected' : ''}>In Progress</option>
            <option value="completed" ${goal && goal.status === 'completed' ? 'selected' : ''}>Completed</option>
            <option value="cancelled" ${goal && goal.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
          </select>
        </div>
        <div class="form-group">
          <label for="progress">Progress (%)</label>
          <input type="number" id="progress" name="progress" min="0" max="100" value="${goal ? goal.progress : 0}">
        </div>
      </div>

      <div class="form-group">
        <label for="visibility">Visibility</label>
        <select id="visibility" name="visibility">
          <option value="public" ${goal && goal.visibility === 'public' ? 'selected' : ''}>Public</option>
          <option value="team_only" ${goal && goal.visibility === 'team_only' ? 'selected' : ''}>Team Only</option>
          <option value="private" ${goal && goal.visibility === 'private' ? 'selected' : ''}>Private</option>
        </select>
      </div>

      <div class="form-group">
        <label for="keyResults">Key Results</label>
        <textarea id="keyResults" name="keyResults" rows="5" placeholder="Enter each key result on a new line...">${goal && goal.keyResults ? JSON.parse(goal.keyResults).join('\n') : ''}</textarea>
        <span class="form-help">Enter each key result on a separate line</span>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">${goal ? 'Update Goal' : 'Create Goal'}</button>
        <a href="/admin/goals" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>

${goal ? `
<div class="card">
  <div class="card-header">
    <h2>Danger Zone</h2>
  </div>
  <div class="card-body">
    <form action="/admin/goals/${goal.id}/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this goal? This action cannot be undone.')">
      <p class="text-muted">Deleting this goal will permanently remove it from the system.</p>
      <button type="submit" class="btn btn-danger">Delete Goal</button>
    </form>
  </div>
</div>
` : ''}

<div class="page-actions">
  <a href="/admin/goals" class="btn btn-secondary">Back to Goals List</a>
</div>
` }) %>